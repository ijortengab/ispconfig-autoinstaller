#!/bin/bash

THIS_FILE=$(realpath "$0")
DIRECTORY_THIS_FILE=$(dirname "$THIS_FILE")

# --- Generated by parse-options.sh.
_new_arguments=()

while [[ $# -gt 0 ]]; do
    case "$1" in
        --help|-h) help=1; shift ;;
        --domain=*|-d=*) domain="${1#*=}"; shift ;;
        --domain|-d) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then domain="$2"; shift; fi; shift ;;
        --hostname=*) hostname="${1#*=}"; shift ;;
        --hostname) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then hostname="$2"; shift; fi; shift ;;
        --mailbox-admin=*) mailbox_admin="${1#*=}"; shift ;;
        --mailbox-admin) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then mailbox_admin="$2"; shift; fi; shift ;;
        --mailbox-host=*) mailbox_host="${1#*=}"; shift ;;
        --mailbox-host) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then mailbox_host="$2"; shift; fi; shift ;;
        --mailbox-post=*) mailbox_post="${1#*=}"; shift ;;
        --mailbox-post) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then mailbox_post="$2"; shift; fi; shift ;;
        --mailbox-web=*) mailbox_web="${1#*=}"; shift ;;
        --mailbox-web) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then mailbox_web="$2"; shift; fi; shift ;;
        --phpmyadmin-version=*) phpmyadmin_version="${1#*=}"; shift ;;
        --phpmyadmin-version) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then phpmyadmin_version="$2"; shift; fi; shift ;;
        --remote-user-root=*) remote_user_root="${1#*=}"; shift ;;
        --remote-user-root) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then remote_user_root="$2"; shift; fi; shift ;;
        --remote-user-roundcube=*) remote_user_roundcube="${1#*=}"; shift ;;
        --remote-user-roundcube) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then remote_user_roundcube="$2"; shift; fi; shift ;;
        --roundcube-version=*) roundcube_version="${1#*=}"; shift ;;
        --roundcube-version) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then roundcube_version="$2"; shift; fi; shift ;;
        --timezone=*) timezone="${1#*=}"; shift ;;
        --timezone) if [[ ! $2 == "" && ! $2 =~ ^-[^-] ]]; then timezone="$2"; shift; fi; shift ;;
        --[^-]*) shift ;;
        *) _new_arguments+=("$1"); shift ;;
    esac
done

set -- "${_new_arguments[@]}"

_new_arguments=()

while [[ $# -gt 0 ]]; do
    case "$1" in
        -[^-]*) OPTIND=1
            while getopts ":hd:" opt; do
                case $opt in
                    h) help=1 ;;
                    d) domain="$OPTARG" ;;
                esac
            done
            shift "$((OPTIND-1))"
            ;;
        *) _new_arguments+=("$1"); shift ;;
    esac
done

set -- "${_new_arguments[@]}"

unset _new_arguments

# --- End.

# Common function.
red() { echo -ne "\e[91m"; echo -n "$@"; echo -e "\e[39m"; }
green() { echo -ne "\e[92m"; echo -n "$@"; echo -e "\e[39m"; }
yellow() { echo -ne "\e[93m"; echo -n "$@"; echo -e "\e[39m"; }
blue() { echo -ne "\e[94m"; echo -n "$@"; echo -e "\e[39m"; }
magenta() { echo -ne "\e[95m"; echo -n "$@"; echo -e "\e[39m"; }
x() { exit 1; }
e() { echo "$@"; }
__() { echo -n '    '; [ -n "$1" ] && echo "$@" || echo -n ; }
____() { echo; }

# Default value.
[ -n "$timezone" ] || { timezone='Asia/Jakarta'; }
[ -n "$phpmyadmin_version" ] || { phpmyadmin_version='5.2.0'; }
[ -n "$roundcube_version" ] || { roundcube_version='1.6.0'; }
[ -n "$mailbox_admin" ] || { mailbox_admin='admin'; }
[ -n "$mailbox_host" ] || { mailbox_host='hostmaster'; }
[ -n "$mailbox_post" ] || { mailbox_post='postmaster'; }
[ -n "$mailbox_web" ] || { mailbox_web='webmaster'; }
[ -n "$hostname" ] || { mailbox_web='server1'; }
[ -n "$remote_user_root" ] || { remote_user_root='root'; }
[ -n "$remote_user_roundcube" ] || { remote_user_roundcube='roundcube'; }

# todo: devel.
# help=1

if [ -n "$help" ];then
    cat <<'EOF'
Gak Pake Lama ISPConfig Autoinstaller Variation 1

Avilable Options:
    --help|-h                   Show this help.
    --timezone                  Set timezone. Default: `Asia/Jakarta`.
    --phpmyadmin-version        Set PHPMyAdmin version. Default: `5.2.0`.
    --roundcube-version         Set Roundcube version. Default: `1.6.0`.
    --mailbox-admin             Mailbox for admin. Default: `admin`.
    --mailbox-host              Mailbox for hostmaster. Default: `hostmaster`.
    --mailbox-post              Mailbox for postmaster. Default: `postmaster`.
    --mailbox-web               Mailbox for webmaster. Default: `webmaster`.
    --domain                    Set the domain name.
    --hostname                  Set the hostname. Default: `server1`.
    --remote-user-root          Username for ISPConfig remote user for general.
                                Default: `root`.
    --remote-user-roundcube     Username for ISPConfig remote user for mailbox.
                                Default: `roundcube`.

EOF
exit 1
fi

blue '######################################################################'
blue '#                                                                    #'
blue '# Gak Pake Lama ISPConfig Autoinstaller Variation 1                  #'
blue '#                                                                    #'
blue '######################################################################'
____

e Version 0.1.0
____

yellow User variable.
magenta 'timezone="'$timezone'"'
magenta 'phpmyadmin_version="'$phpmyadmin_version'"'
magenta 'roundcube_version="'${roundcube_version}'"'
magenta 'mailbox_admin="'${mailbox_admin}'"'
magenta 'mailbox_host="'${mailbox_host}'"'
magenta 'mailbox_post="'${mailbox_post}'"'
magenta 'mailbox_web="'${mailbox_web}'"'
magenta 'domain="'${domain}'"'
magenta 'hostname="'${hostname}'"'
magenta 'remote_user_root="'${remote_user_root}'"'
magenta 'remote_user_roundcube="'${remote_user_roundcube}'"'
____

this_file=$(realpath "$0")
directory_this_file=$(dirname "$this_file")
parent_pid=$$

[ -f "${directory_this_file}/gpl-ispconfig-variation1-init.sh" ] || {
    red File not found: gpl-ispconfig-variation1-init.sh; x
}
[ -f "${directory_this_file}/gpl-ispconfig-variation1-ispconfig.sh" ] || {
    red File not found: gpl-ispconfig-variation1-ispconfig.sh; x
}

. "${directory_this_file}/gpl-ispconfig-variation1-init.sh"
